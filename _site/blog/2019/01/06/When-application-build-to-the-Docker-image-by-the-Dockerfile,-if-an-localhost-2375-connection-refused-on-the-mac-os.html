<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Kellin's daily life...</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link href="/kudos.css" media="screen" rel="stylesheet" type="text/css" />
  </head>
  <body>


  <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
<script src="/assets/js/functions.js"></script>
<script src="/assets/js/main.js"></script>
<script src="/assets/js/modernizr.js"></script>
<script src="/assets/js/kudos.js"></script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-70467029-1', 'auto');
    ga('send', 'pageview');

</script>

<a href="#" class="back-to-top">Back To Top</a><div id="container" class="logo"></div><header id="h_small"><nav id="nav_small"><a href="/#about-me">About Me</a><a href="/#Experenice">Experience</a><a href="/#Blog">Blog</a><a href="/#Details">Contact Me</a></nav></header>


<script type="text/javascript">
			// needs to be a string for jquery.cookie
			var postId = '1';
			$(function()
			{
				// initialize kudos
				$("figure.kudoable").kudoable();
				// check to see if user has already kudod
				// fyi cookies do not work when you are viewing this as a file
				if($.cookie(postId) == 'true') {
					// make kudo already kudod
					$("figure.kudoable").removeClass("animate").addClass("complete");
					// your server would take care of the proper kudos count, but because this is a
					// static page, we need to set it here so it doesn't become -1 when you remove
					// the kudos after a reload
					$(".num").html(1);
				}
				// when kudoing
				$("figure.kudo").bind("kudo:active", function(e)
				{
					console.log("kudoing active");
				});
				// when not kudoing
				$("figure.kudo").bind("kudo:inactive", function(e)
				{
					console.log("kudoing inactive");
				});
				// after kudo'd
				$("figure.kudo").bind("kudo:added", function(e)
				{
					var element = $(this);
					// ajax'y stuff or whatever you want
					console.log("Kodo'd:", element.data('id'), ":)");
					// set cookie so user cannot kudo again for 7 days
					$.cookie(postId, 'true', { expires: 7 });
				});
				// after removing a kudo
				$("figure.kudo").bind("kudo:removed", function(e)
				{
					var element = $(this);
					// ajax'y stuff or whatever you want
					console.log("Un-Kudo'd:", element.data('id'), ":(");
					// remove cookie
					$.removeCookie(postId);
				});
			});
		</script>



<div class="post-header">
  <h1 class="post-title">When application build to the Docker image by the Dockerfile, if an localhost:2375 connection refused on the Mac OS.</h1>
</div>
<div class="post-header">
  <p class="post-meta">January 6, 2019 — 09:35</p>
</div>

<div class="post-wrapper">



  <article class="post-content">
    <div class = "blurb-blog">
    <p>When we make the Docker image by the Maven and Dockerfile, on the Spring project.</p>

<p>There are several plugins for making the Docker image, we can use the <strong><a href="https://github.com/spotify/docker-maven-plugin">docker-maven-plugin</a></strong> of them.</p>

<p>This story is about a occurred exception of connection refused, when I use the docker-maven-plugin.</p>

<p>First, let’s look at code of the pom.xml.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.spotify<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>docker-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.4.9<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;imageName&gt;</span>${docker.image.prefix}/${project.artifactId}<span class="nt">&lt;/imageName&gt;</span>
        <span class="nt">&lt;dockerDirectory&gt;</span>src/main/docker<span class="nt">&lt;/dockerDirectory&gt;</span>
        <span class="nt">&lt;resources&gt;</span>
            <span class="nt">&lt;resource&gt;</span>
                <span class="nt">&lt;targetPath&gt;</span>/<span class="nt">&lt;/targetPath&gt;</span>
                <span class="nt">&lt;directory&gt;</span>${project.build.directory}<span class="nt">&lt;/directory&gt;</span>
                <span class="nt">&lt;include&gt;</span>${project.build.finalName}.jar<span class="nt">&lt;/include&gt;</span>
            <span class="nt">&lt;/resource&gt;</span>
        <span class="nt">&lt;/resources&gt;</span>
    <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/plugin&gt;</span>
</code></pre></div></div>

<p>I’ve added the code to the ‘&lt;plugins&gt; … &lt;/plugins&gt;’.</p>

<p>If you are using over the JDK 9, you will meet the error message.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Caused by: java.lang.ClassNotFoundException: javax.activation.DataSource
</code></pre></div></div>

<p>Then you add the Java activation dependency in the plugin configuration to resolve.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.spotify<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>docker-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.4.9<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;imageName&gt;</span>${docker.image.prefix}/${project.artifactId}<span class="nt">&lt;/imageName&gt;</span>
        <span class="nt">&lt;dockerDirectory&gt;</span>src/main/docker<span class="nt">&lt;/dockerDirectory&gt;</span>
        <span class="nt">&lt;resources&gt;</span>
            <span class="nt">&lt;resource&gt;</span>
                <span class="nt">&lt;targetPath&gt;</span>/<span class="nt">&lt;/targetPath&gt;</span>
                <span class="nt">&lt;directory&gt;</span>${project.build.directory}<span class="nt">&lt;/directory&gt;</span>
                <span class="nt">&lt;include&gt;</span>${project.build.finalName}.jar<span class="nt">&lt;/include&gt;</span>
            <span class="nt">&lt;/resource&gt;</span>
        <span class="nt">&lt;/resources&gt;</span>
    <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.activation<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>activation<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.1.1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
    <span class="nt">&lt;/plugin&gt;</span>
</code></pre></div></div>

<p>And next problem is the connection refused, at the <strong>mvn docker:build</strong> command executed.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[ERROR] Failed to execute goal com.spotify:docker-maven-plugin:0.4.9:build 
(default-cli) on project image-reader-api: Exception caught: java.util.concurrent.ExecutionException: 
com.spotify.docker.client.shaded.javax.ws.rs.ProcessingException: org.apache.http.conn.HttpHostConnectException: 
Connect to localhost:2375 [localhost/127.0.0.1, localhost/0:0:0:0:0:0:0:1] failed: Connection refused 
(Connection refused) -&gt; [Help 1]
</code></pre></div></div>

<p>When we look at the Exception messages, it says that failed connect to the the 2375 port of the Localhost.</p>

<p>The 2375 port is the Rest-API port of docker daemon, if we are using the Windows-os, it’s easy to resolve.</p>

<p>Go to settings menu of the Docker for windows, and check to the Expose daemon on.</p>

<p><img src="https://user-images.githubusercontent.com/4101636/50725577-daed2880-1142-11e9-9999-01f5a6a8402c.png" alt="image" width="100%" />
<span style="color: #A6A6A6; font-size: 12px;">(https://intellij-support.jetbrains.com/hc/en-us/community/posts/115000327324–Docker-Setting-Connection-refused-on-localhost-2375)</span></p>

<p>But, we can’t find that menu on the Docker for mac-os.</p>

<p><img src="https://user-images.githubusercontent.com/4101636/50725672-1e946200-1144-11e9-9630-6c8dba694a8d.png" alt="image" width="100%" /></p>

<p>How should we resolve this issue?</p>

<p>The easiest way is to add the small linux container on the Local docker, and it is redirect the Docker api to tcp port on our the Mac-os host.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -d -v /var/run/docker.sock:/var/run/docker.sock -p 127.0.0.1:2375:2375 
bobrik/socat TCP-LISTEN:2375,fork UNIX-CONNECT:/var/run/docker.sock

export DOCKER_HOST=tcp://localhost:2375
</code></pre></div></div>

<p>Let’s try that one again, perhaps the issue has been resolved.</p>

   </div>
  </article>


</div>
<div class="comment">
  
  </div>

  <footer><div class="lockup"><div class="content-wrap"><nav><a href="#about-me">About Me</a><a href="#Experenice">Experience</a><a href="#Blog">Blog</a><a href="#Details">Contact Me</a></nav><p class="copyright">kellin 2018</p></div></div></footer>
  </body>
</html>
